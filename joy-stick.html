<!-- The joy-stick custom element -->
<template class="joy-stick-template">
  <style>
    button, button:active, button:hover {
      font-size: 240%;
      background-color: transparent;
      color: white;
      border: none;
      margin: 0;
      padding: 0;
    }

    .up, .down, .left, .right { position: fixed; }

    .up, .down { width: 20%; height: 15%; left: 40%; }
    .up { bottom: 15%; }
    .down { bottom: 0; }

    .left, .right { width: 40%; height: 30%; bottom: 0; }
    .left { left: 0; text-align: right; }
    .right { right: 0; text-align: left; }
  </style>
  
  <button class="up">▲</button>
  <button class="left">◀</button>
  <button class="right">▶</button>
  <button class="down">▼</button>
</template>
  
<script>
/**
 * A JoyStick.
 */
class JoyStick extends HTMLElement {
  /**
   * Constructor.
   */
  constructor() {
    super()

    /**
     * Shadow DOM of our tag.
     * @member {ShadowRoot}
     */
    this.root = this.attachShadow({ mode: 'open' })
    this.root.appendChild(JoyStick.template.cloneNode(true))

    /**
     * Buttons.
     * @member {Object}
     * @private
     */
    this.buttons = {
      up: this.root.querySelector("button.up"),
      down: this.root.querySelector("button.down"),
      left: this.root.querySelector("button.left"),
      right: this.root.querySelector("button.right"),
    }

    // Listen to keystrokes.
    document.addEventListener(
      "keydown", e => this.fireEvent(JoyStick.keyCodes[e.keyCode])
    )

    // Listen to button clicks.
    for(let item in this.buttons) {
      this.buttons[item].addEventListener("click", () => this.fireEvent(item))
    }
  }

  /**
   * Helper function used to fire joystick-move custom event.
   * @param {string} value A string to pass in the detail of the event.
   * @private
   */
   fireEvent(value) {
    if(value !== undefined) {
      this.dispatchEvent(new CustomEvent('joystick-move', { detail: value }))
    }
  }
}

/**
 * Key codes and their string equivalent
 * @member {Object}
 */
JoyStick.keyCodes = { 37: "left", 38: "up", 39: "right", 40: "down" };

// Retrieve the joystick template.
(function(local) {
  JoyStick.template = local.querySelector(".joy-stick-template").content
})(document.currentScript.ownerDocument)

// Defines the joy-stick custom element.
customElements.define('joy-stick', JoyStick)
</script>
